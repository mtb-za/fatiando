# Build, package and clean Fatiando

help:
	@echo "Commands:"
	@echo ""
	@echo "    develop       install fatiando in editable mode"
	@echo "    cython        generate C code from Cython files"
	@echo "    test          run the test suite (including doctests)"
	@echo "    pep8          check for PEP8 style compliance"
	@echo "    pep8-stats    print a summary of the PEP8 check"
	@echo "    coverage      calculate test coverage using Coverage"
	@echo "    clean         clean up build and generated files"
	@echo ""

develop:
	pip install --no-deps -e .

cython:
	python setup.py build_ext --inplace --cython

.PHONY: test
test: develop
	nosetest --with-doctest -v fatiando test/

coverage: develop
	nosetest --with-doctest --with-coverage --cover-package=fatiando fatiando/ test/

pep8:
	pep8 --show-source --ignore=W503,E226,E241\
		--exclude=_version.py fatiando test cookbook setup.py

pep8-stats:
	pep8 --exclude=_version.py --statistics -qq fatiando test cookbook setup.py

clean:
	find . -name "*.so" -exec rm -v {} \;
	find . -name "*.pyc" -exec rm -v {} \;
	rm -rvf build dist MANIFEST fatiando.egg-info __pycache__
	# Trash generated by the doctests
	rm -rvf mydata.txt mylogfile.log
	# The stuff fetched by the cookbook recipes
	rm -rvf logo.png cookbook/logo.png
	rm -rvf crust2.tar.gz cookbook/crust2.tar.gz
	rm -rvf bouguer_alps_egm08.grd cookbook/bouguer_alps_egm08.grd
	rm -rvf *.gdf cookbook/*.gdf
